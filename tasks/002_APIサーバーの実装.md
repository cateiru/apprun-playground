# 002: API サーバーの実装

## 概要

Echo フレームワークを使用して、シンプルな API サーバーを実装します。`GET /` エンドポイントで `{"status": "ok"}` を返すヘルスチェックエンドポイントを作成します。

## 実装内容

### 1. Echo フレームワークのインストール

```bash
go get github.com/labstack/echo/v4
go get github.com/labstack/echo/v4/middleware
```

### 2. main.go の作成

プロジェクトルートに `main.go` を作成します：

```go
package main

import (
	"net/http"
	"os"

	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
)

type HealthResponse struct {
	Status string `json:"status"`
}

func main() {
	e := echo.New()

	// ミドルウェア
	e.Use(middleware.Logger())
	e.Use(middleware.Recover())
	e.Use(middleware.CORS())

	// ルート
	e.GET("/", handleHealth)

	// サーバー起動
	port := os.Getenv("PORT")
	if port == "" {
		port = "8080"
	}

	e.Logger.Fatal(e.Start(":" + port))
}

func handleHealth(c echo.Context) error {
	response := HealthResponse{
		Status: "ok",
	}
	return c.JSON(http.StatusOK, response)
}
```

### 3. 依存関係の整理

```bash
go mod tidy
```

### 4. ローカルでの動作確認

#### サーバーの起動

```bash
go run main.go
```

#### 動作確認

別のターミナルで以下のコマンドを実行：

```bash
curl http://localhost:8080/
```

期待されるレスポンス：

```json
{"status":"ok"}
```

## ディレクトリ構造

```
apprun-playground/
├── main.go
├── go.mod
├── go.sum
└── README.md
```

## チェックリスト

- [ ] Echo フレームワークをインストール
- [ ] `main.go` を作成
- [ ] ヘルスチェックエンドポイント (`GET /`) を実装
- [ ] ミドルウェア（Logger, Recover, CORS）を設定
- [ ] `go mod tidy` を実行
- [ ] ローカルで `go run main.go` を実行して動作確認
- [ ] `curl` でエンドポイントをテスト
- [ ] レスポンスが `{"status":"ok"}` であることを確認

## 補足

### ポート番号について

- デフォルトは 8080 ポート
- 環境変数 `PORT` で変更可能
- AppRun は環境変数でポート番号を指定する場合があるため、柔軟に対応できるようにしています

### ミドルウェアについて

- **Logger**: リクエストログを出力
- **Recover**: パニック時の復旧
- **CORS**: クロスオリジンリクエストに対応

## 参考リンク

- [Echo Framework](https://echo.labstack.com/)
- [Echo Guide](https://echo.labstack.com/docs)
- [Echo Middleware](https://echo.labstack.com/docs/middleware)
